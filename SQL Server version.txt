SQL Server version
SQL Server Schema (Week 1 Deliverable Update)
-- 1. Create Geography column type support (SQL Server 2008+)
-- No PostGIS needed - SQL Server has native GEOGRAPHY

-- Core Inspections Table
CREATE TABLE inspections (
    id INT IDENTITY(1,1) PRIMARY KEY,
    officer_id VARCHAR(50) NOT NULL,
    location GEOGRAPHY,
    photos NVARCHAR(MAX),  -- JSON array as text
    checklist NVARCHAR(MAX) NOT NULL,  -- JSON checklist
    risk_score FLOAT CHECK (risk_score >= 0 AND risk_score <= 10),
    status VARCHAR(20) DEFAULT 'completed',
    timestamp DATETIME2 DEFAULT GETUTCDATE(),
    created_at DATETIME2 DEFAULT GETUTCDATE()
);

-- Citizen Reports Table
CREATE TABLE citizen_reports (
    id INT IDENTITY(1,1) PRIMARY KEY,
    reporter_id VARCHAR(50),
    location GEOGRAPHY,
    description NVARCHAR(1000),
    photo_url NVARCHAR(500),
    cluster_id INT,
    status VARCHAR(20) DEFAULT 'open',
    timestamp DATETIME2 DEFAULT GETUTCDATE()
);

-- Risk Scoring Audit Log
CREATE TABLE risk_audit (
    id INT IDENTITY(1,1) PRIMARY KEY,
    inspection_id INT,
    raw_score FLOAT,
    factors NVARCHAR(MAX),  -- JSON factors
    created_at DATETIME2 DEFAULT GETUTCDATE()
);

-- Spatial Indexes (SQL Server GEOGRAPHY)
CREATE SPATIAL INDEX idx_inspections_location 
ON inspections(location) 
USING GEOGRAPHY_GRID 
WITH (GRIDS=(LEVEL_1=16,LEVEL_2=16,LEVEL_3=16,LEVEL_4=16));

CREATE SPATIAL INDEX idx_reports_location 
ON citizen_reports(location) 
USING GEOGRAPHY_GRID 
WITH (GRIDS=(LEVEL_1=16,LEVEL_2=16,LEVEL_3=16,LEVEL_4=16));

-- JSON support indexes (SQL Server 2016+)
CREATE INDEX idx_inspections_checklist ON inspections(checklist);
CREATE INDEX idx_reports_status ON citizen_reports(status, timestamp);
